# Bundle API

## Properties

### Important properties

The api for `Bundle` has been designed to be as lightweight as possible. The following properties represent the baseline with which developers should become familiar with before building an app.

|Name       |arguments  | Description  	|
|---	    |---	    |---	|
|`use`   	|Object   	| Takes an object with either a *source*, *transform* or *destination* property and adds it to the pipeline. The order of consecutive `use` invocations in your app will be the order used by the generated pipeline. 	|
|`setThrottle`| Number  | After the source has finished emitting data and called `pipeline.done()`, and the last piece of emitted data has been processed by the destination, the pipeline will close. If setThrottle has been called with an argument that is a positive integer, this number of milliseconds will elapse before a new pipeline is constructed and executed. If setThrottle is called with a negative integer, the pipeline will remain closed and the app will idle.       |
|`take`  	|Number   	| Closes the pipleline after `n` items have been received and processed by the `destination`  	|
|`tap`   	|Function   | Inserts a spy function at a given location in the pipeline. Useful for logging etc.   	|   |


### Properties used by Vizia

The following properties are to be used by Vizia itself, and outside of that
are only expected to be used in your demo environment and/or unit tests.

|Name       |arguments  | Description  	|
|---	    |---	    |---	|
|`load`     | Object    | Injects configuration into the App. Vizia itself will call this function, supplying config from Vizia admin. It is useful to call this function yourself in unit tests and your demo environment.       |
|`start`    | n/a       | Starts the app. A pipeline will be constructed and executed. If `setThrottle` has been called previously with a positive number, once the pipeline has executed it will wait, then execute again continuously. Vizia itself will call this function, but again you will need to in tests and your demo environment.      |
|`stop`     | n/a       | Stops the app. A `stopRequested` event will be emitted immediately, and the pipeline will stop executing as soon as possible. This may not be immediate - some data may still continue down the pipeline if it is already being processed. Useful for unit tests with sources that continuously emit data.      |       |

## Events

Apps created with `Bundle` are instances of `EventEmitter`. Below is a list of events that may be useful in your unit tests.

|Name       |arguments  | Description  	|
|---	    |---	    |---	|
|`start`    | n/a       |Emitted when the app is started.  |
|`end`      | Error     |Emitted when the app stops, either due to an error, or due to the pipeline execution finishing when the app has not been set up to execute repeatedly by use of `.setThrottle(n)`. In the case of an error, the event is supplied with the error instance.|
|`error`    | error     |Emitted by the app if an error occurs, or an error is surfaced in a `source`, `transform` or `destination` via `pipeline.error(err)`|
|`stopRequested`|n/a    |Emitted as soon as `.stop()` is called, but before the app stops processing existing data in the pipeline|
