# Vizia Format

Opinionated formatting to keep the visual language consistent across Vizia UI components, with locale support.

**Number**, **Percent**, **Currency**, **Ordinal**, **Duration**, and all [Intl NumberFormat units](src/lib/intl-number-format-units).

## Intl

This library is reliant on the [Intl API](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl), and uses the proposed [intl-unified-number-format](https://github.com/tc39/proposal-unified-intl-numberformat) to format additional units. At this time, Chrome has support, but Firefox and Safari do not; a polyfill is included and should be removed when support has been added.

## Usage

```js
const viziaFormat = require('@vizia/format');
```

##### Number

```js
const result = viziaFormat(1234);
// 1,234
```

```js
const result = viziaFormat(12345.12345);
// 12.35k
```

##### Currency

```js
const result = viziaFormat(1234.1234, {
    format: 'currency',
    currency: 'GBP'
});
// £1,234.12
```

```js
const result = viziaFormat(12345.12345, {
    format: 'currency',
    currency: 'JPY'
});
// ¥12.35k
```

A `currencySymbol` can be used instead of a currency code. **NB:** This is not recommended and should only be used if the currency code is not available.

```js
const result = viziaFormat(12345.12345, {
    format: 'currency',
    currencySymbol: '¥'
});
// ¥12.35k
```

##### Percent

```js
const result = viziaFormat(0.12345, {
    format: 'percent'
});
// 12.35%
```

##### Ordinal

```js
const result = viziaFormat(12345, {
    format: 'ordinal'
});
// 12,345th
```

##### Duration

Accepts milliseconds as value, and will choose the best humanised duration for the result.

```js
const result = viziaFormat(12345, {
    format: 'duration'
});
// 12s 35ms
```

##### Other units

If the Intl NumberFormat accepts the unit, it will map the format to a unit and render using `format='number'` rules. An additional parameter `unitDisplay` can be used for further formatting. The full list of available formats can be seen [here](src/lib/intl-number-format-units).

```js
const result = viziaFormat(30, {
    format: 'celsius'
});
// 30°C
```

```js
const result = viziaFormat(30, {
    format: 'years',
    unitDisplay: 'long'
});
// 30 years
```

### Output

The default `output` is a string, but `html` can be specified to inherit CSS styles. The CSS can be imported with:

```js
require('@vizia/vizia-format/src/index.css');
```

For `output='html'`, an HTML string is returned.

```js
const result = viziaFormat(12345.12345, {
    format: 'currency',
    currency: 'GBP',
    output: 'html'
});
// <span class="viz-format"><span class="viz-format__currency">£</span>12.35k</span>
```

Alternatively, a custom function can be passed. This is designed to map straight to `React.createElement`, without resorting to `dangerouslySetInnerHTML`.

```js
const result = viziaFormat(12345.12345, {
    format: 'currency',
    currency: 'GBP',
    output: React.createElement
});
// React component that represents the HTML output
```

### Options

| Key              | Value           | Default    | Description                                                                                                                                      | Affects formats |
|:-----------------|:----------------|:-----------|:-------------------------------------------------------------------------------------------------------------------------------------------------|:----------------|
| `format`         | String          | `'number'` | Output format. Value can be `'number'`, `'percent'`, `'currency'`, `'ordinal'`, `'duration'`, or any of the supported Intl NumberFormat formats. | –               |
| `currency`       | String          | `'USD'`    | Currency code.                                                                                                                                   | currency        |
| `currencySymbol` | String          | `null`     | Currency symbol. **Only use this if the currency code is not available**.                                                                        | currency        |
| `unitDisplay`    | String          | `'narrow'` | Unit display for 'unit' formats, passed directly to `Intl.NumberFormat` options. Value can be 'narrow', 'short', 'long'.                         | unit            |
| `output`         | String/Function | `'string'` | The output format (`'string'`, `'html'`). Additionally, a custom function can be used, e.g. `React.createElement`.                               | all             |
| `locale`         | String          | `'en-GB'`  | Locale code.                                                                                                                                     | all             |

##### Advanced Options

**NB:** Unless there is an important edge-case, it is not recommended that you override these for the sake of consistency and easier maintenance.

| Key             | Value   | Default        | Description                                                                                                                                        | Affects formats                 |
|:----------------|:--------|:---------------|:---------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------|
| `mantissa`      | Number  | `2`            | Number of decimal points.                                                                                                                          | number, percent, currency, unit |
| `trimMantissa`  | Boolean | `true`         | Trims the decimal point when result is a float (e.g. `0.50` returns `0.5`). This is only effective when the number is not abbreviated.             | number, percent, unit           |
| `abbr`          | Boolean | `true`         | Abbreviates the output when the absolute value is equal to or greater than the `abbrThreshold`.                                                    | number, percent, currency, unit |
| `abbrThreshold` | Number  | `9999.5`       | The threshold at which abbreviation takes place. This is only effective when `abbr=true`. Changes the default to `99.995` when `format='percent'`. | number, percent, currency, unit |
| `bemBlock`      | String  | `'viz-format'` | CSS BEM block class-name. This is only effective when `output='html'`.                                                                             | all                             |

## Demo

To see example tables, there is a demo available to visualize or quickly debug results.

```sh
lerna run start --scope @vizia/format --stream
```
